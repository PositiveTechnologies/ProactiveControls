# C8: Повсеместная защита данных

## Описание

Конфиденциальные данные, такие как пароли, номера кредитных карт, медицинские записи, персональные данные и коммерческие тайны, требуют дополнительной защиты, особенно если они подпадают под действие закона о неприкосновенности данных, например Общего регламента ЕС по защите данных, или закона о защите финансовых данных, например Стандарта безопасности данных в сфере платежных карт (PCI DSS).

Злоумышленники могут похитить данные из веб-приложений и веб-служб множеством разных способов. Например, атакующий может подключиться к общей беспроводной сети и просмотреть или похитить конфиденциальные данные других пользователей, если они передаются через небезопасное интернет-подключение. Также злоумышленник может использовать внедрение SQL-кода, чтобы похитить пароли и другие учетные данные из приложений, а затем выложить их в открытый доступ.

## Классификация данных

Необходимо классифицировать данные в вашей системе и определить уровень значимости каждого блока данных. Каждая категория данных затем может быть соотнесена с правилами защиты, определяемыми для каждого уровня значимости. Например, публичная маркетинговая информация, не являющаяся конфиденциальной, может быть отнесена к общедоступным данным, которые можно размещать на общедоступном сайте. Номера кредитных карт можно отнести к персональным данным пользователей, которые требуют шифрования при их хранении или передаче.

## Шифрование передаваемых данных

При передаче конфиденциальных данных через любую сеть необходимо применять сквозную защиту соединений (или шифрование). TLS, безоговорочно, является самым распространенным и поддерживаемым криптографическим протоколом, обеспечивающим безопасность соединений. Он используется во многих сферах (веб-приложения, веб-службы, мобильные приложения) для безопасной передачи данных по сети. Для обеспечения безопасности соединений TLS необходимо правильно настроить.

Основная польза от протокола TLS — это защита данных веб-приложений от несанкционированного доступа и изменений при их передаче между клиентами (веб-браузерами) и сервером веб-приложения, а также между сервером веб-приложения и внутренним сервером или другими, не относящимися к браузеру, компонентами организации.

## Шифрование хранимых данных

Первое правило управления конфиденциальными данными — избегать хранения конфиденциальных данных, когда это возможно. Если сохранять конфиденциальные данные необходимо, то убедитесь в наличии у них криптографической защиты от несанкционированного доступа и изменений.

Криптография является одной из самых передовых областей информационной безопасности, ее понимание требует обширных знаний и опыта. Трудно выбрать какое-то одно единственное решение, поскольку существует множество разных подходов к шифрованию, каждый из которых имеет свои преимущества и недостатки, которые веб-архитекторы и веб-разработчики должны четко понимать. Более того, серьезное криптографическое исследование обычно основывается на высшей математике и теории чисел, что создает высокий входной порог.

Вместо создания новых алгоритмов шифрования с нуля настойчиво рекомендуем использовать решения с открытым исходным кодом, которые прошли независимую экспертизу, например, [Google Tink](https://github.com/google/tink) или [Libsodium](https://www.libsodium.org/), а также возможности безопасного хранения, встроенные во многие средства разработки ПО и облачные службы.

### Мобильные приложения: Безопасное локальное хранение данных

Мобильные приложения представляют особую группу риска утечки данных, поскольку мобильные устройства регулярно теряются и воруются, но при этом содержат конфиденциальные данные.

На мобильных устройствах необходимо хранить минимум данных. Но если вам необходимо хранить конфиденциальные данные на мобильном устройстве, то эти данные должны храниться в специальном каталоге, в каждой мобильной ОС он свой. В Андроиде это будет хранилище ключей Android, а в iOS — связка ключей iOS.

### Жизненный цикл ключей

Секретные ключи используются в приложениях для нескольких целей. Например, секретные ключи могут использоваться для подписи токенов JWT, защиты кредитных карт, различных форм аутентификации, а также для других функций обеспечения безопасности критически важных данных. При управлении ключами придерживайтесь следующих правил:

* обеспечьте защиту секретных ключей от несанкционированного доступа;
* храните ключи в соответствующем хранилище, как это описано ниже;
* используйте независимые ключи, когда требуются несколько ключей;
* реализуйте возможность замены алгоритмов и ключей, при необходимости;
* реализуйте в приложении механизм смены ключей.

### Управление секретами в приложении

Приложения содержат огромное количество "секретов", необходимых для выполнения проверок безопасности, например сертификаты, пароли SQL-соединений, учетные данные сторонних служб, пароли, SSH-ключи и ключи шифрования. Несанкционированное разглашение или изменение этих секретов может привести к полной компрометации системы. При управлении секретами в приложениях придерживайтесь следующих правил:

* не храните секретные ключи в коде, файлах конфигурации, а также не передавайте их через переменные окружения. Используйте [GitRob](https://github.com/michenriksen/gitrob) или [TruffleHog](https://github.com/dxa4481/truffleHog) для поиска секретов в репозиториях;
* используйте для ключей и прочих секретов уровня приложения специальные хранилища, например, [KeyWhiz](https://github.com/square/keywhiz), [Vault project](https://www.vaultproject.io/) от компании Hashicorp или [Amazon KMS](https://aws.amazon.com/kms/), обеспечивающие безопасность хранения и доступа к секретным ключам во время работы приложения.

## Предотвращаемые уязвимости

* [Топ-10 OWASP 2017 - А3: Разглашение конфиденциальных данных](https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure)
* [Топ-10 OWASP 2014 (мобильные устройства) - M2: Небезопасное хранение данных](https://www.owasp.org/index.php/Mobile_Top_10_2014-M2)

## Ссылки

* [Памятка OWASP: Защита транспортного уровня](https://www.owasp.org/index.php/Transport_Layer_Protection_Cheat_Sheet)
* [Ivan Ristic: Рекомендации по реализации SSL/TLS](https://www.ssllabs.com/projects/best-practices/index.html)
* [Памятка OWASP: Принудительное использование HTTPS (HSTS)](https://www.owasp.org/index.php/HTTP_Strict_Transport_Security_Cheat_Sheet)
* [Памятка OWASP: Хранение в зашифрованном виде](https://www.owasp.org/index.php/Cryptographic_Storage_Cheat_Sheet)
* [Памятка OWASP: Хранение паролей](https://www.owasp.org/index.php/Password_Storage_Cheat_Sheet)
* [Памятка OWASP: Для разработчиков iOS - Небезопасное хранение данных](https://www.owasp.org/index.php/IOS_Developer_Cheat_Sheet#Insecure_Data_Storage_.28M1.29)
* [Руководство OWASP по тестированию: Тестирование TLS](https://www.owasp.org/index.php/Testing_for_Weak_SSL/TLS_Ciphers,_Insufficient_Transport_Layer_Protection_(OTG-CRYPST-001))

## Инструменты

* [SSLyze](https://github.com/nabla-c0d3/sslyze) — интерфейс командной строки и библиотека для сканирования конфигураций SSL
* [SSLLabs](https://www.ssllabs.com/ssltest/) — бесплатная служба для сканирования и проверки конфигураций TLS/SSL
* [OWASP O-Saft TLS Tool](https://www.owasp.org/index.php/O-Saft) — инструмент для тестирования TLS-соединений
* [GitRob](https://github.com/michenriksen/gitrob) — инструмент командной строки для поиска критически важных данных в общедоступных файлах на GitHub
* [TruffleHog](https://github.com/dxa4481/truffleHog)  — инструмент для поиска случайно закоммиченных секретов
* [KeyWhiz](https://github.com/square/keywhiz) — менеджер секретов
* [Hashicorp Vault](https://www.vaultproject.io/) — менеджер секретов
* [Amazon KMS](https://aws.amazon.com/kms/) — инструмент управления ключами на Amazon AWS